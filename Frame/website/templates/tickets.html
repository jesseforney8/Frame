{% extends "base1.html" %}

{% block title%} Tickets {% endblock%}

{%block navbar %}
<div class="searchbar">
  
  <div class="dropdown">
    <button class="dropbtn" onclick="dropdown1()">Filter</button>
    <div class="dropdowninfo" id="dropdowninfo1">
        <button class="drplink" id="searchowner" onclick="add_search()">Owner</button>
        <button class="drplink" id="searchgroup" onclick="add_search1()">Group</button>
    </div>
  <input class="search" type="text" id="filterinput">
  <input class="search" type="text" id="finalsearch">
  <button class="dropbtn">Search</button>
</div>
</div>

{%endblock%}

{% block body %}

<ul class="list-group">
    {% for ticket in tickets %}
    
        <p1  id="id">{{ticket.id}}</p1>
        <p1><b>Title:</b> {{ ticket.title }}</p1>
        <p1><b>Description:</b> {{ ticket.body }}</p1>
        <p1><b>Ticket Owner:</b>{{ ticket.owner }}</p1>
        <p1><b>Ticket Submitter:</b> {{ ticket.submitter }}</p1>
        <p1><b>Ticket Type:</b> {{ ticket.type }}</p1>
        <p1><b>Urgency:</b> {{ ticket.urgency }}</p1>

        <button  id="btn_{{ticket.id}}" onclick="GotoTicket('{{ticket.id}}')">View</button>
        
        {% if user.role == "Administrator" %}
         
        <button  type="button" onclick="deleteTicket('{{ticket.id}}')">Delete</button>

        {% elif user.role == "Super Administrator" %}
         
        <button  type="button" onclick="deleteTicket('{{ticket.id}}')">Delete</button>
                
        
        {% endif %}
    
    {% endfor %}



</ul>



<script>
function GotoTicket(ticketId) {
            fetch("/tickets", {
              method: "POST",
              body: JSON.stringify({ ticketId: ticketId}),
            }).then((_res) => {
                window.location.href = "/ticket";
            });
          }
        

function add_search() {
  let btnval = document.getElementById("searchowner");
  let finalsearch = document.getElementById("finalsearch");
  let filterinput = document.getElementById("filterinput");
  
  finalsearch.value = btnval.textContent + ": " + filterinput.value;
  
}

function add_search1() {
  let btnval = document.getElementById("searchgroup");
  let finalsearch = document.getElementById("finalsearch");
  let filterinput = document.getElementById("filterinput");
  
  finalsearch.value = btnval.textContent + ": " + filterinput.value;
  
}










</script>














{% endblock %}